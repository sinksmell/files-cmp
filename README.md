## files-cmp

#### 如果两台机器，每台机器上有1000w 个小文件，其中可能有3-5 个文件内容不同，但两个机器直接网络很差(如几百 M 需要传输 10 小时).磁盘很好(SSD)。用 golang 写个程序，在尽可能少使用内存并尽可能快的情况下找出这几个文件，并输出不同之处。之后可能会有增量变动,能够把增量变动同步出来。


### 策略设计
> 根据题目意思,是大量文件的对比,两台机器的文件数量,名称一致。

* 1. 使用linux下的ls命令,获取所要对比文件的文件名列表(自动按字母序排列),和文件数目N
* 2. 对所有文件进行分组 分组的大小是N的平方根取整
* 3. 遍历文件集合,读取文件 计算其*Md5值* 以 *文件名:Md5值*的形式存入分组文件*group_id.txt*中
* 4. Client向Server发送请求 内容为 *分组文件名*和该文件的*Md5值*
* 4.1 若服务端比较对应的文件Md5值相同 则 继续处理下一个分组
* 4.2 若服务端比较对应的文件Md5值不相同 则在该文件中找到Md5值不同的文件名 告诉Client发送该文件进行比较

> 上述比较策略中,每次网络请求发送的 要么是一段*json数据*,要么是一个*分组文件/小文件* 大大减小了网络数据传输量


#### 从Md5值不同的分组文件中找出 文件名相同Md5值不同的文件

* 1. 读取 Server对应的分组文件,逐行格式化读取 *文件名:Md5值*格式 建立一个Map[文件名]Md5值
* 2. 读取Client传过来的分组文件,逐行格式化读取,若Map不存在对应记录,或者改文件对应的Md5值不同,则将该文件名加入结果集中
* 3. 返回该结果集,告知Client发送结果集内的文件


#### 对比两个小文件内容

* 1. 文件为文本文件,分析各自独特有的内容,分析文件变化情况,高亮显示不同内容
* 2. 文件为非文本文件(二进制,jpg,mp4等),读取文件的前512个字节,作为文本对比文本内容不分析变化


#### 运行方法
> 1. go run main.go 即开启服务端
> 2. cd client && go run client.go 开启客户端 自动对比file文件夹下的所有文件 

#### 运行效果图


* 对比分组文件,找到小文件,然后再对比小文件
![](https://i.loli.net/2019/04/15/5cb42272d379b.png)

* 对比分组文件 
![](https://i.loli.net/2019/04/15/5cb42273da1c0.png)


* 对比jpg文件(截取部分输出结果)
![](https://i.loli.net/2019/04/15/5cb42271dc899.png)
![](https://i.loli.net/2019/04/15/5cb42274e3ecd.png)

